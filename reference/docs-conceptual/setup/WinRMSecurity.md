---
ms.date: 2017-06-05
keywords: PowerShell parancsmag
title: WinRMSecurity
ms.openlocfilehash: 65cf12466c9dc8fc8b77d79b0d63a6ae61e64d60
ms.sourcegitcommit: d6ab9ab5909ed59cce4ce30e29457e0e75c7ac12
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 09/08/2017
---
# <a name="powershell-remoting-security-considerations"></a><span data-ttu-id="2a677-103">PowerShell távoli eljáráshívás biztonsági megfontolások</span><span class="sxs-lookup"><span data-stu-id="2a677-103">PowerShell Remoting Security Considerations</span></span>

<span data-ttu-id="2a677-104">PowerShell-távelérést az ajánlott módszer a Windows rendszerek kezelésére.</span><span class="sxs-lookup"><span data-stu-id="2a677-104">PowerShell Remoting is the recommended way to manage Windows systems.</span></span> <span data-ttu-id="2a677-105">A Windows Server 2012 R2 alapértelmezés szerint engedélyezve van a PowerShell távelérése.</span><span class="sxs-lookup"><span data-stu-id="2a677-105">PowerShell Remoting is enabled by default in Windows Server 2012 R2.</span></span> <span data-ttu-id="2a677-106">Ez a dokumentum ismerteti a biztonsági aggályokon, javaslatok és ajánlott eljárások PowerShell távoli eljáráshívás használatakor.</span><span class="sxs-lookup"><span data-stu-id="2a677-106">This document covers security concerns, recommendations, and best practices when using PowerShell Remoting.</span></span>

## <a name="what-is-powershell-remoting"></a><span data-ttu-id="2a677-107">Mi az a PowerShell távelérése?</span><span class="sxs-lookup"><span data-stu-id="2a677-107">What is PowerShell Remoting?</span></span>

<span data-ttu-id="2a677-108">PowerShell távvezérlése használja [Windows Rendszerfelügyeleti (webszolgáltatások WinRM)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384426.aspx), vagyis a Microsoft általi implementációja a [felügyeleti webszolgáltatások (WS-Management)](http://www.dmtf.org/sites/default/files/standards/documents/DSP0226_1.2.0.pdf) protokollt, a felhasználó futtathatja a Powershellt a távoli számítógépeken lévő parancsok.</span><span class="sxs-lookup"><span data-stu-id="2a677-108">PowerShell Remoting uses [Windows Remote Management (WinRM)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384426.aspx), which is the Microsoft implementation of the [Web Services for Management (WS-Management)](http://www.dmtf.org/sites/default/files/standards/documents/DSP0226_1.2.0.pdf) protocol, to allow users to run PowerShell commands on remote computers.</span></span> <span data-ttu-id="2a677-109">További információk a PowerShell távelérése található [távoli parancsok futtatása](https://technet.microsoft.com/en-us/library/dd819505.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a677-109">You can find more information about using PowerShell Remoting at [Running Remote Commands](https://technet.microsoft.com/en-us/library/dd819505.aspx).</span></span>

<span data-ttu-id="2a677-110">PowerShell távvezérlése nincs megegyezik a **számítógépnév** paraméter, a parancsmag egy távoli számítógépen, a mögöttes protokollként a távoli eljáráshívás (RPC) használó futtatásához.</span><span class="sxs-lookup"><span data-stu-id="2a677-110">PowerShell Remoting is not the same as using the **ComputerName** parameter of a cmdlet to run it on a remote computer, which uses Remote Procedure Call (RPC) as its underlying protocol.</span></span>

## <a name="powershell-remoting-default-settings"></a><span data-ttu-id="2a677-111">PowerShell távvezérlése alapértelmezett beállítások</span><span class="sxs-lookup"><span data-stu-id="2a677-111">PowerShell Remoting default settings</span></span>

<span data-ttu-id="2a677-112">PowerShell távoli eljáráshívás (és a Rendszerfelügyeleti webszolgáltatások) figyelni a következő portokat:</span><span class="sxs-lookup"><span data-stu-id="2a677-112">PowerShell Remoting (and WinRM) listen on the following ports:</span></span>

- <span data-ttu-id="2a677-113">HTTP: 5985</span><span class="sxs-lookup"><span data-stu-id="2a677-113">HTTP: 5985</span></span>
- <span data-ttu-id="2a677-114">HTTPS: 5986-OS</span><span class="sxs-lookup"><span data-stu-id="2a677-114">HTTPS: 5986</span></span>

<span data-ttu-id="2a677-115">Alapértelmezés szerint PowerShell-távelérés csak kapcsolatait a Rendszergazdák csoport tagjai.</span><span class="sxs-lookup"><span data-stu-id="2a677-115">By default, PowerShell Remoting only allows connections from members of the Administrators group.</span></span> <span data-ttu-id="2a677-116">Munkamenetek indítja a felhasználó környezetében, az összes operációs rendszer hozzáférés-vezérlést alkalmazni egyes felhasználók és csoportok továbbra is vonatkoznak rájuk PowerShell távoli eljáráshívás keresztül csatlakozik.</span><span class="sxs-lookup"><span data-stu-id="2a677-116">Sessions are launched under the user's context, so all operating system access controls applied to individual users and groups continue to apply to them while connected over PowerShell Remoting.</span></span>

<span data-ttu-id="2a677-117">A magánhálózatokon az alapértelmezett Windows tűzfalszabály a PowerShell távelérése összes kapcsolatokat fogad.</span><span class="sxs-lookup"><span data-stu-id="2a677-117">On private networks, the default Windows Firewall rule for PowerShell Remoting accepts all connections.</span></span> <span data-ttu-id="2a677-118">A nyilvános hálózatokon a Windows tűzfal alapértelmezett szabály lehetővé teszi, hogy PowerShell távoli eljáráshívás kapcsolatokat csak az ugyanazon az alhálózaton belül.</span><span class="sxs-lookup"><span data-stu-id="2a677-118">On public networks, the default Windows Firewall rule allows PowerShell Remoting connections only from within the same subnet.</span></span> <span data-ttu-id="2a677-119">Akkor explicit módon módosítsa az adott szabály, amely nyissa meg a PowerShell távelérése nyilvános hálózaton minden olyan kapcsolatnál.</span><span class="sxs-lookup"><span data-stu-id="2a677-119">You have to explicitly change that rule to open PowerShell Remoting to all connections on a public network.</span></span>

><span data-ttu-id="2a677-120">**Figyelmeztetés:** a nyilvános hálózatok tűzfalszabály arra szolgál, hogy megvédeni a számítógépet a potenciálisan rosszindulatú külső csatlakozási kísérletek.</span><span class="sxs-lookup"><span data-stu-id="2a677-120">**Warning:** The firewall rule for public networks is meant to protect the computer from potentially malicious external connection attempts.</span></span> <span data-ttu-id="2a677-121">Mindig legyen óvatos, ez a szabály.</span><span class="sxs-lookup"><span data-stu-id="2a677-121">Use caution when removing this rule.</span></span>

## <a name="process-isolation"></a><span data-ttu-id="2a677-122">Folyamat elkülönítési</span><span class="sxs-lookup"><span data-stu-id="2a677-122">Process isolation</span></span>

<span data-ttu-id="2a677-123">PowerShell távvezérlése használ [Windows Rendszerfelügyeleti (webszolgáltatások WinRM)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384426) számítógépek közötti kommunikációhoz.</span><span class="sxs-lookup"><span data-stu-id="2a677-123">PowerShell Remoting uses [Windows Remote Management (WinRM)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384426) for communication between computers.</span></span> <span data-ttu-id="2a677-124">A Rendszerfelügyeleti webszolgáltatások szolgáltatásként a hálózati szolgáltatás fiók alatt fut, és felhasználói fiókok futtató gazdagép PowerShell példányokhoz elszigetelt folyamatokban indít.</span><span class="sxs-lookup"><span data-stu-id="2a677-124">WinRM runs as a service under the Network Service account, and spawns isolated processes running as user accounts to host PowerShell instances.</span></span> <span data-ttu-id="2a677-125">Egy felhasználóként fut PowerShell példánya nem egy másik felhasználóként PowerShell példányának futó folyamat hozzáférése van.</span><span class="sxs-lookup"><span data-stu-id="2a677-125">An instance of PowerShell running as one user has no access to a process running an instance of PowerShell as another user.</span></span>

## <a name="event-logs-generated-by-powershell-remoting"></a><span data-ttu-id="2a677-126">PowerShell-távelérés által generált eseménynaplók</span><span class="sxs-lookup"><span data-stu-id="2a677-126">Event logs generated by PowerShell Remoting</span></span>

<span data-ttu-id="2a677-127">FireEye megadta az eseménynaplókat és a biztonsági PowerShell távoli eljáráshívás munkamenetek, rendelkezésre álló által generált jó összefoglalása</span><span class="sxs-lookup"><span data-stu-id="2a677-127">FireEye has provided a good summary of the event logs and other security evidence generated by PowerShell Remoting sessions, available at</span></span>  
<span data-ttu-id="2a677-128">[PowerShell kivizsgálása támadások](https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf).</span><span class="sxs-lookup"><span data-stu-id="2a677-128">[Investigating PowerShell Attacks](https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf).</span></span>

## <a name="encryption-and-transport-protocols"></a><span data-ttu-id="2a677-129">Titkosítás és átviteli protokollok</span><span class="sxs-lookup"><span data-stu-id="2a677-129">Encryption and transport protocols</span></span>

<span data-ttu-id="2a677-130">Akkor célszerű figyelembe kell venni a biztonsági egy PowerShell-távelérést kapcsolat két perspektíva adatai alapján: kezdeti hitelesítést és a folyamatban lévő kommunikációt.</span><span class="sxs-lookup"><span data-stu-id="2a677-130">It is helpful to consider the security of a PowerShell Remoting connection from two perspectives: initial authentication, and ongoing communication.</span></span> 

<span data-ttu-id="2a677-131">A szállítási használt protokoll (HTTP vagy HTTPS), függetlenül PowerShell távoli eljáráshívás mindig titkosítja kezdeti hitelesítés után az összes kommunikáció egy munkamenet-AES-256 szimmetrikus kulcsot.</span><span class="sxs-lookup"><span data-stu-id="2a677-131">Regardless of the transport protocol used (HTTP or HTTPS), PowerShell Remoting always encrypts all communication after initial authentication with a per-session AES-256 symmetric key.</span></span>
    
### <a name="initial-authentication"></a><span data-ttu-id="2a677-132">Kezdeti hitelesítési</span><span class="sxs-lookup"><span data-stu-id="2a677-132">Initial authentication</span></span>

<span data-ttu-id="2a677-133">Hitelesítési megerősíti, hogy az ügyfél a kiszolgáló - és a kiszolgáló az ügyfélnek ideális - identitását.</span><span class="sxs-lookup"><span data-stu-id="2a677-133">Authentication confirms the identity of the client to the server - and ideally - the server to the client.</span></span>
    
<span data-ttu-id="2a677-134">Amikor egy ügyfél csatlakozik-e a számítógép nevének tartománykiszolgálóhoz (pl.: kiszolgalo01, vagy server01.contoso.com), az alapértelmezett hitelesítési protokoll [Kerberos](https://msdn.microsoft.com/en-us/library/windows/desktop/aa378747.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a677-134">When a client connects to a domain server using its computer name (i.e.: server01, or server01.contoso.com), the default authentication protocol is [Kerberos](https://msdn.microsoft.com/en-us/library/windows/desktop/aa378747.aspx).</span></span>
<span data-ttu-id="2a677-135">Kerberos biztosítja, hogy a felhasználó identitása és a kiszolgáló identitásának rendezést a újrafelhasználható hitelesítő adatok elküldése nélkül.</span><span class="sxs-lookup"><span data-stu-id="2a677-135">Kerberos guarantees both the user identity and server identity without sending any sort of reusable credential.</span></span>

<span data-ttu-id="2a677-136">Ha az ügyfél csatlakozik egy tartományhoz kiszolgálóhoz IP-címére, vagy egy munkacsoport-kiszolgáló csatlakozik, a Kerberos-hitelesítés nincs lehetőség.</span><span class="sxs-lookup"><span data-stu-id="2a677-136">When a client connects to a domain server using its IP address, or connects to a workgroup server, Kerberos authentication is not possible.</span></span> <span data-ttu-id="2a677-137">Ebben az esetben PowerShell távoli eljáráshívás támaszkodik a [NTLM hitelesítési protokoll](https://msdn.microsoft.com/en-us/library/windows/desktop/aa378749.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a677-137">In that case, PowerShell Remoting relies on the [NTLM authentication protocol](https://msdn.microsoft.com/en-us/library/windows/desktop/aa378749.aspx).</span></span> <span data-ttu-id="2a677-138">Az NTLM hitelesítési protokoll biztosítja, hogy a felhasználói identitás rendezést a EU hitelesítő adatok elküldése nélkül.</span><span class="sxs-lookup"><span data-stu-id="2a677-138">The NTLM authentication protocol guarantees the user identity without sending any sort of delegable credential.</span></span> <span data-ttu-id="2a677-139">Felhasználó identitásának igazolásához, az NTLM protokoll megköveteli, hogy az ügyfél- és számítási a felhasználók a munkamenetkulcsot maga a jelszó átállítására lenne cseréje nélkül.</span><span class="sxs-lookup"><span data-stu-id="2a677-139">To prove user identity, the NTLM protocol requires that both the client and server compute a session key from the user's password without ever exchanging the password itself.</span></span> <span data-ttu-id="2a677-140">A kiszolgáló általában nem tudja a felhasználó jelszava, így a tartományvezérlő, amely a felhasználói jelszó ismerete, és kiszámítja a munkamenetkulcsot a kiszolgáló kommunikál.</span><span class="sxs-lookup"><span data-stu-id="2a677-140">The server typically does not know the user's password, so it communicates with the domain controller, which does know the user's password and calculates the session key for the server.</span></span> 
      
<span data-ttu-id="2a677-141">Az NTLM protokoll nem, azonban biztosítja kiszolgáló identitását.</span><span class="sxs-lookup"><span data-stu-id="2a677-141">The NTLM protocol does not, however, guarantee server identity.</span></span> <span data-ttu-id="2a677-142">Minden protokoll, amely a hitelesítéshez használandó NTLM, a támadó egy tartományhoz csatlakozó számítógép hozzáférő tudta meghívni a(z) kiszámításához az NTLM-munkamenetkulcs, és ezáltal megszemélyesíteni a kiszolgáló a tartományvezérlő.</span><span class="sxs-lookup"><span data-stu-id="2a677-142">As with all protocols that use NTLM for authentication, an attacker with access to a domain-joined computer's machine account could invoke the domain controller to compute an NTLM session-key and thereby impersonate the server.</span></span>

<span data-ttu-id="2a677-143">NTLM-alapú hitelesítés alapértelmezés szerint le van tiltva, de engedélyezhető, vagy a célkiszolgáló konfigurálása SSL, vagy a WinRM TrustedHosts beállítás konfigurálásáról az ügyfélen.</span><span class="sxs-lookup"><span data-stu-id="2a677-143">NTLM-based authentication is disabled by default, but may be permitted by either configuring SSL on the target server, or by configuring the WinRM TrustedHosts setting on the client.</span></span>
    
#### <a name="using-ssl-certificates-to-validate-server-identity-during-ntlm-based-connections"></a><span data-ttu-id="2a677-144">Kiszolgáló identitásának ellenőrzése során kapcsolatok NTLM-alapú SSL-tanúsítványok használatával</span><span class="sxs-lookup"><span data-stu-id="2a677-144">Using SSL certificates to validate server identity during NTLM-based connections</span></span>

<span data-ttu-id="2a677-145">Az NTLM hitelesítési protokoll nem tudja biztosítani az identitás a célkiszolgáló (csak az, hogy azt már tudja, hogy a jelszó), mivel az SSL használatához a PowerShell távelérése a célkiszolgálók konfigurálhatja.</span><span class="sxs-lookup"><span data-stu-id="2a677-145">Since the NTLM authentication protocol cannot ensure the identity of the target server (only that it already knows your password), you can configure target servers to use SSL for PowerShell Remoting.</span></span> <span data-ttu-id="2a677-146">Egy SSL-tanúsítvány hozzárendelése a cél kiszolgálón (Ha ki egy hitelesítésszolgáltatónak, amely az ügyfél is megbízhatónak találja) lehetővé teszi, hogy az NTLM-alapú hitelesítés, amely biztosítja, hogy a felhasználó identitása és a kiszolgáló identitását.</span><span class="sxs-lookup"><span data-stu-id="2a677-146">Assigning a SSL certificate to the target server (if issued by a Certificate Authority that the client also trusts) enables NTLM-based authentication that guarantees both the user identity and server identity.</span></span>
    
#### <a name="ignoring-ntlm-based-server-identity-errors"></a><span data-ttu-id="2a677-147">NTLM-alapú kiszolgáló identitásának hibák figyelmen kívül hagyásával</span><span class="sxs-lookup"><span data-stu-id="2a677-147">Ignoring NTLM-based server identity errors</span></span>
      
<span data-ttu-id="2a677-148">Ha egy SSL-tanúsítvány telepítése a kiszolgálóra NTLM kapcsolatok lehessen hozni, akkor előfordulhat, hogy ne jelenjen meg többé az eredményül kapott identitás hibák adja hozzá a kiszolgálón a winrm **TrustedHosts** listája.</span><span class="sxs-lookup"><span data-stu-id="2a677-148">If deploying a SSL certificate to a server for NTLM connections is infeasible, you may suppress the resulting identity errors by adding the server to the WinRM **TrustedHosts** list.</span></span> <span data-ttu-id="2a677-149">Vegye figyelembe, hogy a kiszolgáló nevét a TrustedHosts listához való hozzáadás nem lehet tekinteni bármely formájára vonatkozó rendszerállapot-kimutatását a gazdagépek maguk megbízhatósága – az NTLM hitelesítési protokoll nem garantálja, hogy ténylegesen kapcsolódik a gazdagéphez, a rendszer csatlakozni kívánó.</span><span class="sxs-lookup"><span data-stu-id="2a677-149">Please note that adding a server name to the TrustedHosts list should not be considered as any form of statement of the trustworthiness of the hosts themselves - as the NTLM authentication protocol cannot guarantee that you are in fact connecting to the host you are intending to connect to.</span></span>
<span data-ttu-id="2a677-150">Ehelyett érdemes lehet a TrustedHosts beállítás, amelynek a hibát, hogy a kiszolgáló identitásának ellenőrzése nem állítja elő szeretné gazdagépek listájának.</span><span class="sxs-lookup"><span data-stu-id="2a677-150">Instead, you should consider the TrustedHosts setting to be the list of hosts for which you wish to suppress the error generated by being unable to verify the server's identity.</span></span>
    
    
### <a name="ongoing-communication"></a><span data-ttu-id="2a677-151">A folyamatban lévő kommunikáció</span><span class="sxs-lookup"><span data-stu-id="2a677-151">Ongoing Communication</span></span>

<span data-ttu-id="2a677-152">Ha a kezdeti hitelesítési befejeződött, a [PowerShell távoli eljáráshívás protokoll](https://msdn.microsoft.com/en-us/library/dd357801.aspx) titkosítja az összes folyamatban lévő kommunikációs munkamenet-AES-256 szimmetrikus kulcsot.</span><span class="sxs-lookup"><span data-stu-id="2a677-152">Once initial authentication is complete, the [PowerShell Remoting Protocol](https://msdn.microsoft.com/en-us/library/dd357801.aspx) encrypts all ongoing communication with a per-session AES-256 symmetric key.</span></span>  


## <a name="making-the-second-hop"></a><span data-ttu-id="2a677-153">A kétugrásos elvégzése</span><span class="sxs-lookup"><span data-stu-id="2a677-153">Making the second hop</span></span>

<span data-ttu-id="2a677-154">Alapértelmezés szerint PowerShell-távelérést használja (ha elérhető) Kerberos vagy NTLM-hitelesítéshez.</span><span class="sxs-lookup"><span data-stu-id="2a677-154">By default, PowerShell Remoting uses Kerberos (if available) or NTLM for authentication.</span></span> <span data-ttu-id="2a677-155">Mindkét ezeket a protokollokat hitelesíteni a távoli számítógépre, azt a hitelesítő adatok elküldése nélkül.</span><span class="sxs-lookup"><span data-stu-id="2a677-155">Both of these protocols authenticate to the remote machine without sending credentials to it.</span></span>
<span data-ttu-id="2a677-156">Ez a legbiztonságosabb módja hitelesítéséhez, de a távoli számítógép nem rendelkezik a felhasználói hitelesítő adatokat, mert nem fér hozzá más számítógépek és szolgáltatások a felhasználó nevében.</span><span class="sxs-lookup"><span data-stu-id="2a677-156">This is the most secure way to authenticate, but because the remote machine does not have the user's credentials, it cannot access other computers and services on the user's behalf.</span></span> <span data-ttu-id="2a677-157">Ez más néven a "második Ugrás hiba".</span><span class="sxs-lookup"><span data-stu-id="2a677-157">This is known as the "second hop problem".</span></span>

<span data-ttu-id="2a677-158">A probléma elkerülése érdekében számos módja van.</span><span class="sxs-lookup"><span data-stu-id="2a677-158">There are several ways to avoid this problem.</span></span> <span data-ttu-id="2a677-159">Ezek a módszerek és az informatikai szakemberek és az egyes hátrányait: [a kétugrásos létrehozása a PowerShell távelérése](PS-remoting-second-hop.md).</span><span class="sxs-lookup"><span data-stu-id="2a677-159">For descriptions of these methods, and the pros and cons of each, see [Making the second hop in PowerShell Remoting](PS-remoting-second-hop.md).</span></span>










